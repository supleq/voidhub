-- SAB Modded Games Stealer (Black & Purple Edition - Final Clean Stop Version)
-- • Black & Purple theme
-- • Glitchy fast teleport with momentum
-- • Rapid tool switching
-- • Missing tool alerts
-- • Clean stop on arrival (zero velocity) + 1 second delay before kick (no anchor)
-- • Teleport 30 studs above the collect zone (modified to target above "Collect Zone" instead of base sign)
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Tool names
local tool1Name = "Flying Carpet"
local tool2Name = "Grapple Hook"

-- GUI setup
local gui = Instance.new("ScreenGui")
gui.Name = "SABModdedGamesStealer"
gui.ResetOnSpawn = false
gui.Parent = playerGui

-- Alert GUI (for missing tools)
local alertGui = Instance.new("ScreenGui")
alertGui.Name = "StealerAlert"
alertGui.ResetOnSpawn = false
alertGui.Parent = playerGui

local alertFrame = Instance.new("Frame")
alertFrame.Size = UDim2.new(0, 400, 0, 100)
alertFrame.Position = UDim2.new(0.5, -200, 0.5, -50)
alertFrame.BackgroundColor3 = Color3.fromRGB(20, 0, 20)
alertFrame.BackgroundTransparency = 0.1
alertFrame.BorderSizePixel = 0
alertFrame.Visible = false
alertFrame.Parent = alertGui

local alertCorner = Instance.new("UICorner", alertFrame)
alertCorner.CornerRadius = UDim.new(0, 12)

local alertStroke = Instance.new("UIStroke", alertFrame)
alertStroke.Thickness = 3
alertStroke.Color = Color3.fromRGB(200, 0, 200)

local alertText = Instance.new("TextLabel")
alertText.Size = UDim2.new(1, -20, 1, -20)
alertText.Position = UDim2.new(0, 10, 0, 10)
alertText.BackgroundTransparency = 1
alertText.TextColor3 = Color3.fromRGB(255, 100, 255)
alertText.TextStrokeTransparency = 0.7
alertText.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
alertText.Font = Enum.Font.GothamBold
alertText.TextSize = 28
alertText.TextWrapped = true
alertText.Text = ""
alertText.Parent = alertFrame

-- Function to show alert
local function showAlert(message)
    alertText.Text = message
    alertFrame.Visible = true
    
    alertFrame.BackgroundTransparency = 0.8
    alertText.TextTransparency = 1
    TweenService:Create(alertFrame, TweenInfo.new(0.3), {BackgroundTransparency = 0.1}):Play()
    TweenService:Create(alertText, TweenInfo.new(0.3), {TextTransparency = 0}):Play()
    
    task.delay(3, function()
        if alertFrame.Visible then
            TweenService:Create(alertFrame, TweenInfo.new(0.5), {BackgroundTransparency = 1}):Play()
            TweenService:Create(alertText, TweenInfo.new(0.5), {TextTransparency = 1}):Play()
            task.delay(0.5, function()
                alertFrame.Visible = false
            end)
        end
    end)
end

-- Main Frame
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 300, 0, 220)
frame.Position = UDim2.new(0.5, -150, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
frame.BackgroundTransparency = 0.2
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = gui

local corner = Instance.new("UICorner", frame)
corner.CornerRadius = UDim.new(0, 12)

-- Purple gradient stroke
local frameStroke = Instance.new("UIStroke")
frameStroke.Thickness = 1.5
frameStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
frameStroke.Parent = frame
local frameGradient = Instance.new("UIGradient")
frameGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(128, 0, 128)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 0, 200)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(128, 0, 128))
}
frameGradient.Rotation = 45
frameGradient.Parent = frameStroke

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 32)
titleBar.BackgroundColor3 = Color3.fromRGB(50, 0, 50)
titleBar.BorderSizePixel = 0
titleBar.Parent = frame

local title = Instance.new("TextLabel")
title.Text = "VoidHub Insta Stealer 2.0"
title.Size = UDim2.new(1, -80, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Left
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = titleBar

-- Minimize Button
local minimize = Instance.new("TextButton")
minimize.Text = "-"
minimize.Size = UDim2.new(0, 32, 0, 32)
minimize.Position = UDim2.new(1, -36, 0, 0)
minimize.BackgroundColor3 = Color3.fromRGB(80, 0, 80)
minimize.BackgroundTransparency = 0.1
minimize.TextColor3 = Color3.fromRGB(255, 255, 255)
minimize.Font = Enum.Font.GothamBold
minimize.TextSize = 18
minimize.Parent = titleBar
local minCorner = Instance.new("UICorner", minimize)
minCorner.CornerRadius = UDim.new(0, 8)

-- Body (two columns)
local body = Instance.new("Frame")
body.Size = UDim2.new(1, 0, 1, -62)
body.Position = UDim2.new(0, 0, 0, 32)
body.BackgroundTransparency = 1
body.Parent = frame

local leftColumn = Instance.new("Frame")
leftColumn.Size = UDim2.new(0.5, -10, 1, 0)
leftColumn.Position = UDim2.new(0, 10, 0, 0)
leftColumn.BackgroundTransparency = 1
leftColumn.Parent = body

local rightColumn = Instance.new("Frame")
rightColumn.Size = UDim2.new(0.5, -10, 1, 0)
rightColumn.Position = UDim2.new(0.5, 0, 0, 0)
rightColumn.BackgroundTransparency = 1
rightColumn.Parent = body

-- Footer
local footer = Instance.new("TextLabel")
footer.Size = UDim2.new(1, 0, 0, 30)
footer.Position = UDim2.new(0, 0, 1, -30)
footer.BackgroundTransparency = 1
footer.Text = '<font color="rgb(128, 0, 128)">discord.gg/2yYuqnxbzu</font>'
footer.TextColor3 = Color3.fromRGB(128, 0, 128)
footer.Font = Enum.Font.GothamBold
footer.TextSize = 14
footer.RichText = true
footer.TextXAlignment = Enum.TextXAlignment.Center
footer.Parent = frame

-- Discord watermark
local discordText = Instance.new("TextLabel")
discordText.Size = UDim2.new(1, 0, 1, 0)
discordText.BackgroundTransparency = 1
discordText.Text = "discord.gg/2yYuqnxbzu"
discordText.TextColor3 = Color3.fromRGB(200, 0, 200)
discordText.Font = Enum.Font.GothamBold
discordText.TextSize = 50
discordText.TextTransparency = 0.5
discordText.TextXAlignment = Enum.TextXAlignment.Center
discordText.TextYAlignment = Enum.TextYAlignment.Center
discordText.Parent = gui

local tweenInfoFade = TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.InOut, -1, true)
local fadeTween = TweenService:Create(discordText, tweenInfoFade, {TextTransparency = 0.9})
fadeTween:Play()

-- Button factory
local function makeButton(text, parent, yPos, specialColor)
    local btn = Instance.new("TextButton")
    btn.Text = text
    btn.Size = UDim2.new(1, 0, 0, 38)
    btn.Position = UDim2.new(0, 0, 0, yPos)
    btn.BackgroundColor3 = specialColor or Color3.fromRGB(30, 0, 30)
    btn.BackgroundTransparency = 0.2
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.AutoButtonColor = true
    btn.Parent = parent
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = btn
    
    local uiStroke = Instance.new("UIStroke")
    uiStroke.Thickness = 2
    uiStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    uiStroke.Parent = btn
    local uiGradient = Instance.new("UIGradient")
    uiGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(150, 0, 150)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 0, 200)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 0, 150))
    }
    uiGradient.Rotation = 90
    uiGradient.Parent = uiStroke
    return btn
end

-- Buttons
local tpBase = makeButton("TP to base", leftColumn, 0)
local instantSteal = makeButton("Instant steal (OFF)", leftColumn, 45, Color3.fromRGB(80, 0, 80))
local desyncBtn = makeButton("Desync (Off)", leftColumn, 90)

local speedBtn = makeButton("Speed (Off)", rightColumn, 0)
local mapEspBtn = makeButton("Map ESP (ON)", rightColumn, 45)
local myBaseEspBtn = makeButton("My Base ESP (ON)", rightColumn, 90)

-- Minimize logic
local minimized = false
local fullSize = frame.Size
local tweenInfo = TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
minimize.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        TweenService:Create(frame, tweenInfo, {Size = UDim2.new(0, 300, 0, 32)}):Play()
        body.Visible = false
        footer.Visible = false
    else
        TweenService:Create(frame, tweenInfo, {Size = fullSize}):Play()
        task.wait(0.25)
        body.Visible = true
        footer.Visible = true
    end
end)

-- Find base sign
local function findSignForPlayer(name)
    name = string.lower(name)
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BillboardGui") or obj:IsA("SurfaceGui") then
            for _, child in ipairs(obj:GetDescendants()) do
                if child:IsA("TextLabel") and string.find(string.lower(child.Text), name, 1, true) then
                    if obj.Parent and obj.Parent:IsA("BasePart") then
                        return obj.Parent
                    end
                end
            end
        elseif obj:IsA("TextLabel") and obj.Parent and obj.Parent:IsA("BasePart") then
            if string.find(string.lower(obj.Text), name, 1, true) then
                return obj.Parent
            end
        end
    end
end

-- Find collect zone closest to the given sign part
local function findCollectZone(signPart)
    local candidates = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BillboardGui") or obj:IsA("SurfaceGui") then
            for _, child in ipairs(obj:GetDescendants()) do
                if child:IsA("TextLabel") and string.lower(child.Text) == "collect zone" then
                    if obj.Parent and obj.Parent:IsA("BasePart") then
                        table.insert(candidates, obj.Parent)
                    end
                end
            end
        elseif obj:IsA("TextLabel") and obj.Parent and obj.Parent:IsA("BasePart") then
            if string.lower(obj.Text) == "collect zone" then
                table.insert(candidates, obj.Parent)
            end
        end
    end
    if #candidates == 0 then return nil end
    -- Find closest to signPart
    local closest = candidates[1]
    local minDist = (signPart.Position - candidates[1].Position).Magnitude
    for i = 2, #candidates do
        local dist = (signPart.Position - candidates[i].Position).Magnitude
        if dist < minDist then
            minDist = dist
            closest = candidates[i]
        end
    end
    return closest
end

-- Final clean-stop steal function
local function performSteal(targetPos, feedbackButton)
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if not humanoid then return end
    local backpack = player:WaitForChild("Backpack")
    local originalPos = hrp.Position
    local distance = (targetPos - originalPos).Magnitude
    
    -- Tool check + alerts
    local tool1 = backpack:FindFirstChild(tool1Name) or char:FindFirstChild(tool1Name)
    local tool2 = backpack:FindFirstChild(tool2Name) or char:FindFirstChild(tool2Name)
    
    if not tool1 and not tool2 then
        showAlert("Missing both tools:\n" .. tool1Name .. "\nand\n" .. tool2Name)
        if feedbackButton then
            feedbackButton.Text = "Missing tools!"
            task.delay(2, function()
                feedbackButton.Text = feedbackButton == tpBase and "TP to base" or (instantStealEnabled and "Instant steal (ON)" or "Instant steal (OFF)")
            end)
        end
        return
    elseif not tool1 then
        showAlert("Missing tool:\n" .. tool1Name)
        if feedbackButton then
            feedbackButton.Text = "Missing " .. tool1Name .. "!"
            task.delay(2, function()
                feedbackButton.Text = feedbackButton == tpBase and "TP to base" or (instantStealEnabled and "Instant steal (ON)" or "Instant steal (OFF)")
            end)
        end
        return
    elseif not tool2 then
        showAlert("Missing tool:\n" .. tool2Name)
        if feedbackButton then
            feedbackButton.Text = "Missing " .. tool2Name .. "!"
            task.delay(2, function()
                feedbackButton.Text = feedbackButton == tpBase and "TP to base" or (instantStealEnabled and "Instant steal (ON)" or "Instant steal (OFF)")
            end)
        end
        return
    end
    
    if feedbackButton then
        feedbackButton.Text = "Stealing..."
    end

    local speed = 200
    local totalTime = distance / speed
    local segmentTime = totalTime / 8
    local ti = TweenInfo.new(segmentTime, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

    local pos25 = originalPos + (targetPos - originalPos) * 0.25
    local pos50 = originalPos + (targetPos - originalPos) * 0.5
    local pos75 = originalPos + (targetPos - originalPos) * 0.75

    local function snapTo(pos)
        hrp.CFrame = CFrame.new(pos)
        local direction = (targetPos - originalPos).Unit
        local horizontalBoost = direction * speed * 1.5
        hrp.Velocity = Vector3.new(horizontalBoost.X, hrp.Velocity.Y, horizontalBoost.Z)
    end

    local function glideTo(pos)
        local tween = TweenService:Create(hrp, ti, {CFrame = CFrame.new(pos)})
        tween:Play()
        tween.Completed:Wait()
    end

    -- Rapid tool switching
    local switching = true
    local current = 1
    task.spawn(function()
        while switching do
            humanoid:UnequipTools()
            if current == 1 then
                humanoid:EquipTool(tool1)
                current = 2
            else
                humanoid:EquipTool(tool2)
                current = 1
            end
            task.wait(0.01)
        end
    end)

    -- Glitchy teleport sequence
    snapTo(pos25)
    glideTo(pos25 + (targetPos - pos25) * 0.1)
    snapTo(originalPos)
    snapTo(pos50)
    glideTo(pos50 + (targetPos - pos50) * 0.1)
    snapTo(pos25)
    snapTo(pos75)
    glideTo(pos75 + (targetPos - pos75) * 0.1)
    snapTo(pos50)
    snapTo(targetPos)
    glideTo(targetPos)

    -- Stop everything cleanly
    switching = false
    humanoid:UnequipTools()
    hrp.Velocity = Vector3.new(0, 0, 0)
    hrp.RotVelocity = Vector3.new(0, 0, 0)

    if feedbackButton then
        feedbackButton.Text = "Stolen!"
    end

    -- Stay standing still for 4 seconds
    task.wait(1)

    player:Kick("EZ tax with voidhub insta steal discord.gg/2yYuqnxbzu")
end

-- TP to Base
tpBase.MouseButton1Click:Connect(function()
    local name = player.DisplayName or player.Name
    local signPart = findSignForPlayer(name) or findSignForPlayer(player.Name)
    if signPart then
        local collectPart = findCollectZone(signPart)
        if collectPart then
            local targetPos = Vector3.new(collectPart.Position.X, collectPart.Position.Y + 30, collectPart.Position.Z)
            performSteal(targetPos, tpBase)
        else
            tpBase.Text = "No collect zone found!"
            task.delay(2, function() tpBase.Text = "TP to base" end)
        end
    else
        tpBase.Text = "No sign found!"
        task.delay(2, function() tpBase.Text = "TP to base" end)
    end
end)

-- Instant Steal
local instantStealEnabled = false
local function setupPrompt(prompt)
    if not prompt:IsA("ProximityPrompt") then return end
    prompt.Triggered:Connect(function(triggeringPlayer)
        if triggeringPlayer == player and instantStealEnabled then
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:WaitForChild("HumanoidRootPart")
            local name = player.DisplayName or player.Name
            local signPart = findSignForPlayer(name) or findSignForPlayer(player.Name)
            if signPart then
                local collectPart = findCollectZone(signPart)
                if collectPart then
                    local targetPos = Vector3.new(collectPart.Position.X, collectPart.Position.Y + 30, collectPart.Position.Z)
                    performSteal(targetPos, instantSteal)
                else
                    instantSteal.Text = "No collect zone found!"
                    task.delay(2, function()
                        instantSteal.Text = instantStealEnabled and "Instant steal (ON)" or "Instant steal (OFF)"
                    end)
                end
            else
                instantSteal.Text = "No sign found!"
                task.delay(2, function()
                    instantSteal.Text = instantStealEnabled and "Instant steal (ON)" or "Instant steal (OFF)"
                end)
            end
        end
    end)
end

for _, obj in ipairs(workspace:GetDescendants()) do setupPrompt(obj) end
workspace.DescendantAdded:Connect(setupPrompt)

instantSteal.MouseButton1Click:Connect(function()
    instantStealEnabled = not instantStealEnabled
    instantSteal.Text = instantStealEnabled and "Instant steal (ON)" or "Instant steal (OFF)"
end)

-- Desync
local desyncEnabled = false
local espBox, espBillboard, serverPosition
desyncBtn.MouseButton1Click:Connect(function()
    desyncEnabled = not desyncEnabled
    desyncBtn.Text = desyncEnabled and "Desync (On)" or "Desync (Off)"
    local char = player.Character
    if not char then return end
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not humanoid or not hrp then return end
    
    if desyncEnabled then
        serverPosition = hrp.Position
        if humanoid:FindFirstChildOfClass("Animator") then humanoid:FindFirstChildOfClass("Animator"):Destroy() end
        
        espBox = Instance.new("BoxHandleAdornment")
        espBox.Size = char:GetExtentsSize() + Vector3.new(0.5, 0.5, 0.5)
        espBox.CFrame = CFrame.new(serverPosition)
        espBox.Transparency = 1
        espBox.Color3 = Color3.fromRGB(128, 0, 128)
        espBox.Thickness = 5
        espBox.Adornee = workspace.Terrain
        espBox.AlwaysOnTop = true
        espBox.ZIndex = 10
        espBox.Parent = workspace.Terrain
        
        espBillboard = Instance.new("BillboardGui")
        espBillboard.Size = UDim2.new(0, 250, 0, 60)
        espBillboard.StudsOffset = Vector3.new(0, espBox.Size.Y / 2 + 6, 0)
        espBillboard.AlwaysOnTop = true
        espBillboard.Adornee = espBox
        espBillboard.Parent = espBox
        
        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1, 0, 1, 0)
        textLabel.BackgroundTransparency = 1
        textLabel.TextColor3 = Color3.fromRGB(200, 0, 200)
        textLabel.TextStrokeTransparency = 0
        textLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        textLabel.Font = Enum.Font.GothamBold
        textLabel.TextSize = 22
        textLabel.Text = string.format("(%.1f, %.1f, %.1f)", serverPosition.X, serverPosition.Y, serverPosition.Z)
        textLabel.Parent = espBillboard
    else
        Instance.new("Animator").Parent = humanoid
        if espBox then espBox:Destroy() end
        if espBillboard then espBillboard:Destroy() end
        serverPosition = nil
    end
end)

-- Speed
local speedEnabled = false
local speedHeartbeat
speedBtn.MouseButton1Click:Connect(function()
    speedEnabled = not speedEnabled
    speedBtn.Text = speedEnabled and "Speed (On)" or "Speed (Off)"
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    
    if speedEnabled then
        speedHeartbeat = RunService.Heartbeat:Connect(function()
            if not speedEnabled then return end
            local humanoid = char:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.MoveDirection.Magnitude > 0 then
                hrp.Velocity = humanoid.MoveDirection * 50
            else
                hrp.Velocity = Vector3.new(0, hrp.Velocity.Y, 0)
            end
        end)
    else
        if speedHeartbeat then speedHeartbeat:Disconnect() end
        hrp.Velocity = Vector3.new(0, hrp.Velocity.Y, 0)
    end
end)

-- Map ESP helpers
local function isPartOfPlayerCharacter(part) 
    if not part then return false end
    local model = part:FindFirstAncestorWhichIsA("Model")
    return model and Players:GetPlayerFromCharacter(model)
end

local function isPartOfAnimatedRig(part)
    if not part then return false end
    local model = part:FindFirstAncestorWhichIsA("Model")
    if not model then return false end
    local humanoid = model:FindFirstChildOfClass("Humanoid")
    if not humanoid then return false end
    local animator = humanoid:FindFirstChildOfClass("Animator")
    if not animator then return false end
    for _, track in animator:GetPlayingAnimationTracks() do
        if track.IsPlaying then return true end
    end
    return false
end

-- Map ESP
local mapEspEnabled = true
local originalMapTrans = {}
local function enableMapEsp()
    originalMapTrans = {}
    for _, obj in workspace:GetDescendants() do
        if obj:IsA("BasePart")
        and not isPartOfPlayerCharacter(obj)
        and not (player.Character and obj:IsDescendantOf(player.Character))
        and obj.Transparency < 1
        and not isPartOfAnimatedRig(obj)
        and not string.find(obj.Name, "Cube.") then
            originalMapTrans[obj] = obj.Transparency
            obj.Transparency = 0.8
        end
    end
end

local function disableMapEsp()
    for obj, trans in pairs(originalMapTrans) do
        if obj and obj.Parent then obj.Transparency = trans end
    end
    originalMapTrans = {}
end

mapEspBtn.MouseButton1Click:Connect(function()
    mapEspEnabled = not mapEspEnabled
    mapEspBtn.Text = "Map ESP " .. (mapEspEnabled and "(ON)" or "(OFF)")
    if mapEspEnabled then enableMapEsp() else disableMapEsp() end
end)

-- My Base ESP
local myBaseEspEnabled = true
local lineAtt0, lineAtt1, lineBeam
local function enableMyBaseEsp()
    disableMyBaseEsp()
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then return end
    local torso = char:FindFirstChild("UpperTorso") or char:FindFirstChild("LowerTorso") or char:FindFirstChild("Torso") or hrp
    local name = player.DisplayName or player.Name
    local signPart = findSignForPlayer(name) or findSignForPlayer(player.Name)
    if not signPart or not signPart:IsA("BasePart") then return end
    local collectPart = findCollectZone(signPart)
    if not collectPart or not collectPart:IsA("BasePart") then return end
    
    lineAtt0 = Instance.new("Attachment", torso)
    lineAtt1 = Instance.new("Attachment", collectPart)
    lineBeam = Instance.new("Beam")
    lineBeam.Attachment0 = lineAtt0
    lineBeam.Attachment1 = lineAtt1
    lineBeam.Width0 = 0.6
    lineBeam.Width1 = 0.6
    lineBeam.FaceCamera = true
    lineBeam.LightEmission = 1
    lineBeam.Brightness = 10
    lineBeam.Transparency = NumberSequence.new(0)
    lineBeam.Parent = workspace.CurrentCamera
    
    task.spawn(function()
        local hue = 0
        while lineBeam and lineBeam.Parent do
            hue = (hue + 0.01) % 1
            lineBeam.Color = ColorSequence.new(Color3.fromHSV(hue, 1, 1))
            task.wait(0.03)
        end
    end)
end

local function disableMyBaseEsp()
    if lineAtt0 then lineAtt0:Destroy() end
    if lineAtt1 then lineAtt1:Destroy() end
    if lineBeam then lineBeam:Destroy() end
    lineAtt0, lineAtt1, lineBeam = nil, nil, nil
end

myBaseEspBtn.MouseButton1Click:Connect(function()
    myBaseEspEnabled = not myBaseEspEnabled
    myBaseEspBtn.Text = "My Base ESP " .. (myBaseEspEnabled and "(ON)" or "(OFF)")
    if myBaseEspEnabled then enableMyBaseEsp() else disableMyBaseEsp() end
end)

-- Initial setup
enableMapEsp()
task.spawn(function()
    local char = player.Character or player.CharacterAdded:Wait()
    char:WaitForChild("HumanoidRootPart")
    if myBaseEspEnabled then enableMyBaseEsp() end
end)

-- Respawn cleanup
player.CharacterAdded:Connect(function()
    desyncEnabled = false
    speedEnabled = false
    desyncBtn.Text = "Desync (Off)"
    speedBtn.Text = "Speed (Off)"
    if speedHeartbeat then speedHeartbeat:Disconnect() end
    if espBox then espBox:Destroy() end
    if espBillboard then espBillboard:Destroy() end
    disableMyBaseEsp()
    if myBaseEspEnabled then task.defer(enableMyBaseEsp) end
    if mapEspEnabled then task.defer(enableMapEsp) end
end)
